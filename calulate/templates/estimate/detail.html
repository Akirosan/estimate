{% extends 'index.html' %}

{% block title %}{{ calculate.name }}{% endblock %}

{% block content %}

{% if form %}
  <form method="post">{% csrf_token %}
    {{ form.as_p }}
    <input type="submit" value="Save">
  </form>
{% endif %}


<div >
    <h5 class="card-header">{{ calculate.name }}</h5>  
    <div class="card-body">
        <div><a href="../">Вернуться к списку</a></div>
    <table class="table table-striped table-sm">
        <tbody>
            <tr>
                <td>Автор</td><td>{{ calculate.author }}</td>
            </tr>
            <tr>
                <td>Дата создания</td><td>{{ calculate.date_create }}</td>
            </tr>
            <tr>
                <td>Дата редактирования</td><td>{{ calculate.date_update }}</td>
            </tr>
            <tr>
                <td>Коэфф. сложности</td><td>{{ calculate.difficulty_factor }}</td>
            </tr>
            <tr>
                <td>Гсм, амортизация</td><td>{{ calculate.fuel_price }}</td>
            </tr>
            <tr>
                <td>Тип расчета</td><td>{{ calculate.tupe_calc }}</td>
            </tr>
            <tr>
                <td>Описание</td><td>{{ calculate.text }}</td>
            </tr>
        </tbody>
    </table>
        

<!-- Table MATERIALS-->
<table class="table table-sm">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Наименование</th>
      <th scope="col">Ед.изм.</th>
      <th scope="col">Цена</th>
      <th scope="col">Количество</th>
      <th scope="col">Сумма</th>
      <th scope="col"></th>
      <th scope="col"></th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
      {% comment %} <tr>
        <th></th>
        <th>
            <div><a href="{% url "add_material" %}">Добавить материал</a></div>
        </th>
    </tr> {% endcomment %}
    <form id="edit_mat", action="{% url 'edit_mat_in_calc' %}" method="post">
      {% csrf_token %}
      <input type="hidden" name="calc_id" type="text" value='{{calculate.pk}}' >
    {% for material in materials %}
      {% comment %} {% if forloop.first %}
      <tr>
          <th></th>
          <th>
              <div>Первая итерация</div>
          </th>
      </tr>
      {% endif %} {% endcomment %}

      
      <tr>
        
          
          

          <th scope="row">{{forloop.counter}}</th>
          <td><a href="#">{{material.material.name}}</a></td>
          <td>{{material.material.measurement_unit}}</td>
          <td><input size="8", maxlength="10", name="price_{{material.pk}}" type="text" value={{material.price}}></td>
          <td><input size="8", maxlength="10", name="quantity_{{material.pk}}" type="text" value={{material.quantity}}></td></td>
          <td>{{material.amount}}</td>
          <td><a href="#1" onClick="window.open('https://www.etm.ru/catalog?searchValue={{material.material.name}}', 'newWin', 'Toolbar=0, Location=0, Directories=0, Status=0, Menubar=0, Scrollbars=0, Resizable=0, Copyhistory=1, Width=800, Height=600')">ЭТМ</a></td>
          <td><a href="#1" onClick="window.open('https://www.minimaks.ru/catalog/?q={{material.material.name}}', 'newWin', 'Toolbar=0, Location=0, Directories=0, Status=0, Menubar=0, Scrollbars=0, Resizable=0, Copyhistory=1, Width=800, Height=600')">Минимакс</a></td>
          
          <td><a href="{% url "delete_material_from_calc" material.pk calculate.id %}">удалить</a></td>
          
      </tr>
      {% if forloop.last %}
      
      
      {% endif %}
    {% empty %}
    Пока ничего нет!)
    {% endfor %}
    <input type="submit" value="Применить">
    </form>
    
    <tr>
      <th></th>
      <th>
        <form id="search_mat", action="{% url 'search_material' %}" method="get">
          {% csrf_token %}
          <input type="hidden" name="calc_id" type="text" value='{{calculate.pk}}' >
          <input name="search_query" type="text" placeholder="Search...">
          <input type="submit" value="Search...">
        </form>
      </th>
      <td></td>
      <td></td>
      <td><strong>ИТОГО</strong></td>
      <td><strong>{{total.material}}</strong></td>
      <td></td>
      <td></td>
      <td></td>
  </tr>
  </tbody>
</table>



<!-- Table WORKS-->

  <table class="table table-hover table-sm">
    <thead class="thead-light">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Наименование</th>
        <th scope="col">Ед.изм.</th>
        <th scope="col">Цена</th>
        <th scope="col">Количество</th>
        <th scope="col">Сумма</th>
      </tr>
    </thead>
    <tbody>
      {% for work in works %}
        {% if forloop.first %}
          <p>Список работ</p>
        {% endif %}
        <tr>
          <th scope="row">{{forloop.counter}}</th>
          <td><a href="#">{{work.work.name}}</a></td>
          <td>{{work.work.measurement_unit}}</td>
          <td>{{work.work.price}}</td>
          <td>{{work.quantity}}</td>
          <td>{{work.amount}}</td>
        </tr>
        {% if forloop.last %}
        <tr>
          <td> ИТОГО </td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>{{ total.work }}</td>
        </tr>
        {% endif %}
      {% empty %}
      Пока ничего нет)
      {% endfor %}

    </tbody>
  </table>





    
    </div>
  </div>
{% endblock %}